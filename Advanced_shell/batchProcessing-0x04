#!/bin/bash

SCRIPT_TO_CHECK="fetch_pokemon_parallel.sh"  # Script you want to verify
POKEMON_LIST=("bulbasaur" "ivysaur" "venusaur" "charmander" "charmeleon")

echo "=== Checking Parallel Pokémon Fetch Script ==="

# 1️⃣ Check if Pokémon list exists
missing_pokemon=false
for p in "${POKEMON_LIST[@]}"; do
    if ! grep -q "$p" "$SCRIPT_TO_CHECK"; then
        echo "❌ Pokémon '$p' not found in script"
        missing_pokemon=true
    fi
done
if [ "$missing_pokemon" = false ]; then
    echo "✅ All Pokémon names found in script"
fi

# 2️⃣ Check if background process operator '&' is used
if grep -E "fetch_pokemon.*\&" "$SCRIPT_TO_CHECK" >/dev/null; then
    echo "✅ Background process usage found"
else
    echo "❌ No background process '&' usage detected"
fi

# 3️⃣ Check if 'wait' is present to handle processes
if grep -q "wait" "$SCRIPT_TO_CHECK"; then
    echo "✅ 'wait' command found for process synchronization"
else
    echo "❌ 'wait' command missing"
fi

# 4️⃣ Final status
if grep -E "fetch_pokemon.*\&" "$SCRIPT_TO_CHECK" >/dev/null && grep -q "wait" "$SCRIPT_TO_CHECK"; then
    echo "🎯 Script handles parallel processes and waits for completion"
else
    echo "⚠️ Script does not fully meet parallel processing requirements"
fi
